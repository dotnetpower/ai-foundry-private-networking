# Azure AI Foundry Private Network Agent Setup - Terraform

ì´ Terraform í…œí”Œë¦¿ì€ Azure AI Foundryì˜ í”„ë¼ì´ë¹— ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì—ì„œ AI Agentë¥¼ ë°°í¬í•˜ê¸° ìœ„í•œ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.

## ğŸ“‹ ì›ë³¸ í…œí”Œë¦¿

ì´ í…œí”Œë¦¿ì€ ë‹¤ìŒ Azure Foundry Samples Bicep í…œí”Œë¦¿ì„ Terraformìœ¼ë¡œ ë³€í™˜í•œ ê²ƒì…ë‹ˆë‹¤:
- [15-private-network-standard-agent-setup](https://github.com/azure-ai-foundry/foundry-samples/tree/main/infrastructure/infrastructure-setup-bicep/15-private-network-standard-agent-setup)

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Azure Resource Group                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    Virtual Network                           â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚   Agent Subnet      â”‚  â”‚   Private Endpoint Subnet   â”‚  â”‚â”‚
â”‚  â”‚  â”‚  (Microsoft.App/    â”‚  â”‚   - AI Services PE          â”‚  â”‚â”‚
â”‚  â”‚  â”‚   environments)     â”‚  â”‚   - Storage PE              â”‚  â”‚â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚   - Cosmos DB PE            â”‚  â”‚â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚   - AI Search PE            â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    AI Services Account                       â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚  AI Project                                          â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Connections                                     â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ Cosmos DB (Thread Storage)                  â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ Storage Account (Agent Storage)             â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ AI Search (Vector Store)                    â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€ Capability Host (Agents)                        â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â”‚  â””â”€â”€ Model Deployment (gpt-4.1)                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Storage Acct  â”‚ â”‚  Cosmos DB    â”‚ â”‚  AI Search    â”‚         â”‚
â”‚  â”‚ (Private)     â”‚ â”‚  (Private)    â”‚ â”‚  (Private)    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    Private DNS Zones                         â”‚â”‚
â”‚  â”‚  - privatelink.services.ai.azure.com                        â”‚â”‚
â”‚  â”‚  - privatelink.openai.azure.com                             â”‚â”‚
â”‚  â”‚  - privatelink.cognitiveservices.azure.com                  â”‚â”‚
â”‚  â”‚  - privatelink.search.windows.net                           â”‚â”‚
â”‚  â”‚  - privatelink.blob.core.windows.net                        â”‚â”‚
â”‚  â”‚  - privatelink.documents.azure.com                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ ëª¨ë“ˆ êµ¬ì¡°

```
infra-foundry-example/
â”œâ”€â”€ main.tf                    # ë©”ì¸ êµ¬ì„± íŒŒì¼
â”œâ”€â”€ variables.tf               # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ outputs.tf                 # ì¶œë ¥ ì •ì˜
â”œâ”€â”€ terraform.tfvars.example   # ì˜ˆì œ ë³€ìˆ˜ íŒŒì¼
â”œâ”€â”€ README.md                  # ì´ íŒŒì¼
â””â”€â”€ modules/
    â”œâ”€â”€ networking/            # VNet, Subnet, NSG
    â”œâ”€â”€ ai-services/           # AI Services Account, Model Deployment
    â”œâ”€â”€ dependencies/          # Storage, Cosmos DB, AI Search
    â”œâ”€â”€ private-endpoints/     # Private Endpoints, DNS Zones
    â”œâ”€â”€ project/               # AI Project, Connections, Capability Host
    â””â”€â”€ rbac/                  # Role Assignments
```

## ğŸš€ ë°°í¬ ë°©ë²•

### 1. ì‚¬ì „ ìš”êµ¬ ì‚¬í•­

- Terraform >= 1.5.0
- Azure CLI (ë¡œê·¸ì¸ í•„ìš”)
- ì ì ˆí•œ Azure êµ¬ë… ê¶Œí•œ

### 2. ë³€ìˆ˜ ì„¤ì •

```bash
# ì˜ˆì œ íŒŒì¼ ë³µì‚¬
cp terraform.tfvars.example terraform.tfvars

# ê°’ ìˆ˜ì •
vim terraform.tfvars
```

### 3. ë°°í¬ ì‹¤í–‰

```bash
# ì´ˆê¸°í™”
terraform init

# ê³„íš í™•ì¸
terraform plan

# ë°°í¬
terraform apply
```

## ğŸ“ ì£¼ìš” ë³€ìˆ˜

| ë³€ìˆ˜ | ì„¤ëª… | ê¸°ë³¸ê°’ |
|------|------|--------|
| `location` | Azure ë¦¬ì „ | `eastus` |
| `resource_group_name` | ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ì´ë¦„ | `rg-ai-foundry-agent` |
| `ai_services_name` | AI Services ê¸°ë³¸ ì´ë¦„ | `aiservices` |
| `model_name` | ë°°í¬í•  ëª¨ë¸ ì´ë¦„ | `gpt-4.1` |
| `model_capacity` | TPM (ë¶„ë‹¹ í† í°) | `30` |
| `vnet_address_prefix` | VNet ì£¼ì†Œ ê³µê°„ | `192.168.0.0/16` |

## ğŸ” ë³´ì•ˆ ê¸°ëŠ¥

- **í”„ë¼ì´ë¹— ë„¤íŠ¸ì›Œí¬**: ëª¨ë“  ë¦¬ì†ŒìŠ¤ê°€ Private Endpointë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
- **ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬**: Agent Subnetì— Microsoft.App/environments ìœ„ì„
- **AAD ì¸ì¦**: ë¡œì»¬ ì¸ì¦ ë¹„í™œì„±í™”, Azure AD ì¸ì¦ë§Œ ì‚¬ìš©
- **RBAC**: ìµœì†Œ ê¶Œí•œ ì›ì¹™ì— ë”°ë¥¸ ì—­í•  í• ë‹¹

## ğŸ“¤ ì¶œë ¥

```hcl
# ì£¼ìš” ì¶œë ¥
ai_account_name      # AI Services ê³„ì • ì´ë¦„
ai_account_endpoint  # AI Services ì—”ë“œí¬ì¸íŠ¸
project_name         # AI Project ì´ë¦„
project_workspace_id # Project ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ID (Agent ì—°ê²°ìš©)
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ì§€ì› ë¦¬ì „**: AI Foundry AgentëŠ” íŠ¹ì • ë¦¬ì „ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
2. **ë¹„ìš©**: ì´ í…œí”Œë¦¿ì€ ì—¬ëŸ¬ Azure ë¦¬ì†ŒìŠ¤ë¥¼ ë°°í¬í•˜ë¯€ë¡œ ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤.
3. **API ë²„ì „**: `2025-04-01-preview` APIë¥¼ ì‚¬ìš©í•˜ë©°, GA ë²„ì „ì—ì„œ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. **Cosmos DB ë¦¬ì „**: Canary ë¦¬ì „ì—ì„œëŠ” westusë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.

## ğŸ”— ê´€ë ¨ ë§í¬

- [Azure AI Foundry Documentation](https://learn.microsoft.com/azure/ai-studio/)
- [Foundry Samples Repository](https://github.com/azure-ai-foundry/foundry-samples)
- [Azure Private Endpoint Documentation](https://learn.microsoft.com/azure/private-link/private-endpoint-overview)
